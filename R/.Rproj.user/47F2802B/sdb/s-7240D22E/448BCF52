{
    "contents" : "#Script Name: LCC-VP_soils_prep_statsgo.R \n#Author: Tina Cormier\n#Date: 05/10/2013\n#\n#Purpose: This script uses STATSGO soils raster data from Dave Theobald, resampled\n#to 800m.  Data originated from: http://www.soilinfo.psu.edu/index.cgi?soil_data&conus&data_cov.\n#\n#Calculates avg sand, clay, silt, bulk density, and ph based on a weighted average\n#of the first 9 layers (150cm) - weighted by layer depth. \n\n\n\nlibrary(raster)\n\nin.ras <- \"C:/Share/LCC-VP/US_soils/Theobald_STATSGO/STATSGO_PS/muid_270y_allMeterics.tif\"\noutdir <- \"C:/Share/LCC-VP/US_soils/Theobald_STATSGO/STATSGO_PS/\"\n\n#Read in soils data\nsoils <- raster(in.ras)\n\n#is.factor(soils)\n#x <- levels(soils)[[1]][1]\n#rat <- as.data.frame(soils@data@attributes)\n\n\n#calculate weighted avg. of soil variables based on depth of layer (found in metadata:C:\\Share\\LCC-VP\\US_soils\\Theobald_STATSGO\\STATSGO_PS\\metadata\\Sand Silt Clay Fractions.mht)\nweights <- c(5,5,10,10,10,20,20,20,50)\n\n\nattach(soils@data@attributes[[1]])\n#soils@data@attributes[[1]]$ID <- as.factor(soils@data@attributes[[1]]$ID)\n#attach(rat)\nsand <- cbind(muid_270y.vat.SAND_L1, muid_270y.vat.SAND_L2, muid_270y.vat.SAND_L3, muid_270y.vat.SAND_L4,\n          muid_270y.vat.SAND_L5, muid_270y.vat.SAND_L6, muid_270y.vat.SAND_L7, muid_270y.vat.SAND_L8,\n          muid_270y.vat.SAND_L9)\nclay <- cbind(muid_270y.vat.CLAY_L1, muid_270y.vat.CLAY_L2, muid_270y.vat.CLAY_L3, muid_270y.vat.CLAY_L4,\n              muid_270y.vat.CLAY_L5, muid_270y.vat.CLAY_L6, muid_270y.vat.CLAY_L7, muid_270y.vat.CLAY_L8,\n              muid_270y.vat.CLAY_L9)\nsilt <- cbind(muid_270y.vat.SILT_L1, muid_270y.vat.SILT_L2, muid_270y.vat.SILT_L3, muid_270y.vat.SILT_L4,\n              muid_270y.vat.SILT_L5, muid_270y.vat.SILT_L6, muid_270y.vat.SILT_L7, muid_270y.vat.SILT_L8,\n              muid_270y.vat.SILT_L9)\nbd <- cbind(muid_270y.vat.L1_BD, muid_270y.vat.L2_BD, muid_270y.vat.L3_BD, muid_270y.vat.L4_BD, \n            muid_270y.vat.L5_BD, muid_270y.vat.L6_BD, muid_270y.vat.L7_BD, muid_270y.vat.L8_BD,\n            muid_270y.vat.L9_BD)\nph <- cbind(mu_ph.L1_PH, mu_ph.L2_PH, mu_ph.L3_PH, mu_ph.L4_PH, mu_ph.L5_PH, mu_ph.L6_PH, mu_ph.L7_PH,\n            mu_ph.L8_PH, mu_ph.L9_PH)\n#awc <- muid_270y.vat.AWC_150\n#rockdepth <- muid_270y.vat.ROCKDEPM\n\n#Calculate new column that is the weighted average of the 9 soil layers above 150cm.\n#Multiply by 100 and round off decimal - to retain some precision but avoid float.\nsoils@data@attributes[[1]]$sand_avg <- round(apply(sand, 1, weighted.mean, weights)*100, digits=0)\nsoils@data@attributes[[1]]$clay_avg <- round(apply(clay, 1, weighted.mean, weights)*100, digits=0)\nsoils@data@attributes[[1]]$silt_avg <- round(apply(silt, 1, weighted.mean, weights)*100, digits=0)\nsoils@data@attributes[[1]]$bd_avg <- round(apply(bd, 1, weighted.mean, weights)*100, digits=0)\nsoils@data@attributes[[1]]$ph_avg <- round(apply(ph, 1, weighted.mean, weights)*100, digits=0)\nsoils@data@attributes[[1]]$awc_150 <- muid_270y.vat.AWC_150\nsoils@data@attributes[[1]]$bedrock_depth <- muid_270y.vat.ROCKDEPM\n\n#write out raster with new variables calculated\n#dt <- dataType(soils)\n\n#list of column names from RAT to write to new raster\ncols <- c(\"UNID\",\"MUID\",\"sand_avg\", \"clay_avg\", \"silt_avg\", \"bd_avg\", \"ph_avg\", \"awc_150\", \"bedrock_depth\")\n\ntbl <- as.data.frame(cbind(soils@data@attributes[[1]]$muid_270y.vat.UNID, soils@data@attributes[[1]]$muid_270y.vat.MUID, soils@data@attributes[[1]]$sand_avg, \n             soils@data@attributes[[1]]$clay_avg, soils@data@attributes[[1]]$silt_avg, soils@data@attributes[[1]]$bd_avg, \n             soils@data@attributes[[1]]$ph_avg, soils@data@attributes[[1]]$awc_150, soils@data@attributes[[1]]$bedrock_depth))\n\nnames(tbl) <- cols\n\noutTbl <- paste(outdir, \"avg_calcs.csv\", sep=\"\")\nwrite.csv(tbl, file=outTbl, quote=F, row.names=F)\n\n\ndetach(soils@data@attributes[[1]])",
    "created" : 1376580307338.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3689640178",
    "id" : "448BCF52",
    "lastKnownWriteTime" : 1369160513,
    "path" : "C:/Share/LCC-VP/scripts/R/LCC-VP_soils_prep_statsgo.R",
    "properties" : {
    },
    "source_on_save" : false,
    "type" : "r_source"
}